<!DOCTYPE html>
<!-- saved from url=(0047)https://engineering.purdue.edu/ece362/lab/lab0/ -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	
        	<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="https://engineering.purdue.edu/ece362/images/favicon362.png">
	<link rel="icon" type="image/png" sizes="32x32" href="https://engineering.purdue.edu/ece362/images/favicon362.png">
	<link rel="icon" type="image/png" sizes="16x16" href="https://engineering.purdue.edu/ece362/images/favicon362.png">


	<link rel="stylesheet" type="text/css" href="./ECE 362 Lab Experiment 0_files/style.css">
    <title>ECE 362 Lab Experiment 0</title>
    <style>
        /* Self-explanatory, and it looks nice */
        html {
            scroll-behavior: smooth;
        }

        /* AD2 vs ADALM2000 styling */
        .tbl {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .tbl tbody {
            width: 100%;
        }
        .tbl th {
            width: 2.5%;
            padding: 0.5% 2% 0.5% 2%;
            text-align: center;
        }
        .tbl th:not(:first-child) { /* recursive - applies to all children, not just one */
            width: 48.75%;
            border-left: 1px solid black;
        }
        .tbl > tbody > tr:not(:first-child) > th {
            font-weight: 200;
        }
        .tbl tr {
            width: 100%;
            border: 1px solid black;
            display: flex;
        }
        figcaption {
            text-align: center;
        }
        .lab_img {
            width: 100%;
            margin-top: 2%;
        }

        /* ToC styling */
        .toc {
            width: 100%;
        }
        .toc th {
            border: 1px solid black;
            padding: 0 1% 0 1%;
        }
        .toc > tbody > tr:first-child > th { 
            text-align: center;
        }
        .toc > tbody > tr:not(:first-child) > th { 
            font-weight: 200;
        }
        .toc > tbody > tr > th:first-child, .toc > tbody > tr > th:last-child {
            text-align: center;
        }
        .toc tbody {
            width: 100%;
        }
        .toc tr {
            width: max-content;
        }
        h2 {
            margin-top: 3%;
        }

        /* Checklist styling */
        .chklst {
            list-style: none;
            padding-left: 20px;
        }
        .chklst > li {
            display: flex;
            flex-direction: row;
            align-items: center;
            margin-bottom: 0.75%;
        }
        .spanbox {
            position: absolute;
            width: 25px;
            height: 25px;
            background-color: transparent;
            border-radius: 5px;
            transition: background-color 0.3s; 
        }
        .chkbox {
            width: 25px;
            height: 25px;
            padding: 0;
            margin: 0 10px 0 0;
            border-radius: 5px;
            display: block;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        .chkbox .inputbox {
            position: absolute;
            opacity: 0;
            z-index: 2;
            width: 25px;
            height: 25px;
        }
        .chkbox .inputbox:checked ~ .spanbox {
            background-color: dimgray;
        }

        .attention {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 4vh 2vw 4vh 2vw;
            background: rgba(0,0,150,0.025);
            border: 1px solid rgba(100,100,255,1);
            border-radius: 5px;
            transition: background-color 0.3s;
        }
        .attention:hover {
            background: rgba(0,0,150,0.075);
        }

    </style>
</head>
<body>
  <header>
    <h1>ECE 362 Lab Experiment 0: Getting Started</h1>
    		<nav>
		<a href="https://engineering.purdue.edu/ece362/">Home</a>

		<a href="https://engineering.purdue.edu/ece362/about/">About</a>
		<a href="https://engineering.purdue.edu/ece362/refs/">References</a>

		<a href="https://engineering.purdue.edu/ece362/lecture/">Lecture</a>
		<a href="https://engineering.purdue.edu/ece362/hw/">Homework</a>
		<a href="https://engineering.purdue.edu/ece362/lab/">Labs</a>


<!--
-->
<!--
-->
		</nav>

  </header>
  <h2>Introduction</h2>

  In ECE362, students will learn fundamentals of microcontrollers,
  including their operation, and usage.  In addition to the lecture
  portion of the course, students are expected to complete a series
  of lab experiments using a microcontroller platform and IDE.
  Computers and measurement equipment are provided in the course
  laboratory facilities to assist students in completing labs,
  however, the course has also been designed to allow students to
  perform experiment exercises on their own computers at home or
  elsewhere.  Instructions provided in this lab document serves as
  a guide to setting up the microcontroller development environment
  used in ECE362 to provide a consistent user experience between
  home and the laboratory.

  <h2>Instructional Objectives</h2>
  <ul>
    <li>To become familiar with the contents of the ECE 362 lab kit</li>
    <li>To learn how to install the SystemWorkbench IDE on your personal computer</li>
    <li>To practice building a project, running a program on the microcontroller, and debugging execution</li>
  </ul>
  <h2 id="toc">Table of Contents</h2>
  <table class="toc">
    <tbody><tr>
      <th>Step</th>
      <th>Description</th>
      <th>Points</th>
    </tr>
    <tr>
      <th>1</th>
      <th><a href="https://engineering.purdue.edu/ece362/lab/lab0/#Place">Place the development board on a breadboard</a></th>
      <th></th>
    </tr>
    <tr>
      <th>2</th>
      <th><a href="https://engineering.purdue.edu/ece362/lab/lab0/#Install">Install the development software</a></th>
      <th></th>
    </tr>
    <tr>
      <th>3</th>
      <th><a href="https://engineering.purdue.edu/ece362/lab/lab0/#Download">Download the Standard Peripheral Library</a></th>
      <th></th>
    </tr>
    <tr>
      <th>4</th>
      <th><a href="https://engineering.purdue.edu/ece362/lab/lab0/#Configure">Configure SystemWorkbench</a></th>
      <th></th>
    </tr>
    <tr>
      <th>5</th>
      <th><a href="https://engineering.purdue.edu/ece362/lab/lab0/#Create">Create a project in SystemWorkbench</a></th>
      <th></th>
    </tr>
    <tr>
      <th>6</th>
      <th><a href="https://engineering.purdue.edu/ece362/lab/lab0/#Edit">Edit and debug a project</a></th>
      <th></th>
    </tr>
    <tr>
      <th>6.6</th>
      <th><a href="https://engineering.purdue.edu/ece362/lab/lab0/#Cdebug">Debug a C program</a></th>
      <th>25</th>
    </tr>
    <tr>
      <th>6.7</th>
      <th><a href="https://engineering.purdue.edu/ece362/lab/lab0/#ASMdebug">Debug an assembly program</a></th>
      <th>25</th>
    </tr>
    <tr>
      <th>7</th>
      <th><a href="https://engineering.purdue.edu/ece362/lab/lab0/#Wire">Wire a device and try it</a></th>
      <th></th>
    </tr>
    <tr>
      <th>8</th>
      <th><a href="https://engineering.purdue.edu/ece362/lab/lab0/#Postlab">Submit your postlab results</a></th>
      <th>50</th>
    </tr>
    <tr>
      <th>&nbsp;</th>
      <th>Total: </th>
      <th>100</th>
    </tr>
  </tbody></table>
  <a href="https://engineering.purdue.edu/ece362/lab/lab0/#Checklist"><p>When you are ready for your lab evaluation, review this checklist.</p></a>

  <h2 id="Prelab">Step 0: Prelab Preparation:</h2>
  <ul>
    <li>Read this entire lab document.</li>
    <li>Read the user manual for the STM32F091 development board.</li>
    <li>Do the <a href="https://engineering.purdue.edu/ece362/submit/?item=prelab0">prelab exercises</a> and submit them before attempting the lab experiment.</li>
  </ul>
  <h2 id="Place">Step 1: Place the development board on a breadboard</h2>

  <p>
    <b><font color="red">For this, and every other lab experiment, you must use your own lab kit.  You must not share your microcontroller or other lab kit materials with other students.  Sharing equipment, when discovered, will result in a zero score for the lab.</font></b>
  </p>

  <p>
    Open your ECE 362 lab kit and find the STM32F091RC microcontroller development board.  It should look like Figure 1, below.  It is a 60-pin board with double-ended pins so that the board can be used in a breadboard as well as used with header connectors that plug in on top.  On one end of the development board, there is a 10-pin programming header.
  </p>
  
  <figure>
    <img class="lab_img" src="./ECE 362 Lab Experiment 0_files/devboard.jpg">
    <b><figcaption>Figure 1: The ECE 362 STM32F091 development board</figcaption></b>
  </figure>
  <p>
    Your ECE Master Lab Kit has a four-panel solderless breadboard
    similar
    to <a href="https://www.elexp.com/03mb118breadboard-quad-steel-plate.html">this
    one</a>.  Read the user manual to learn how to insert the
    development board into the breadboard.  It should be placed so
    that the programming header overhangs the side of the board
    opposite the power connectors.  Place it in the second to the
    bottom panel as shown in Figure 2.  The pins labeled "5V" should
    be in the rightmost columns.  Make sure there are two usable
    breadboard holes on either side of the rows of pins on the board.
    I.e., center the board within the breadboard panel.  We will use
    this configuration for all labs in the course.
  </p>
  <figure>
    <img class="lab_img" src="./ECE 362 Lab Experiment 0_files/four-panel-placement.jpg">
    <b><figcaption>Figure 2: Placement on the breadboard</figcaption></b>
  </figure>
  <p>
    When you insert the board, you may wish to pre-widen the holes
    into which you will place the development board.  Be careful to
    press down only on the push buttons rather than the more delicate
    components on the board.
  </p>

  <figure>
    <img class="lab_img" src="./ECE 362 Lab Experiment 0_files/insert.jpg">
    <b><figcaption>Figure 3: Inserting the development board (into the wrong side of the breadboard)</figcaption></b>
  </figure>

  <p>
    Consult the user manual to determine how to connect the USB programmer to the development board.  If you have a programmer with the wrong pin configuration, you will need to connect four wires between the programmer and the development board in the required locations.  <!--(You can <a href="https://engineering.purdue.edu/ece362/submit/?item=request-adapter">request an adapter</a> to convert the programmer to the expected pin configuration.)-->
  </p>
  <p>
    As long as the USB programmer pins are connected only to the development board programming header pins, there is little chance of damaging the board.  <b>Do not connect the programmer directly to any of the long rows of 30 pins on either side of the development board.  That could cause damage.</b>  Once the programmer is connected to the programming header, plug the USB programmer into your computer.  Use the 3-foot-long USB extension cable if you do not have a USB port near your development board.  You should see the red and green LEDs in the corner of the development board illuminate.  If you do not see these LEDs, unplug the USB programmer immediately and check your wiring.
  </p>

  <h2 id="Install">Step 2: Install the development software</h2>

  <p>
    For embedded software development within ECE362, the open-source Eclipse IDE will be used, alongside the “System Workbench for STM32” Eclipse plugin (supported by STMicroelectronics).  Full instructions for the installation of of this software is OpenSTM32 installation instructions, available on_the <a href="http://www.openstm32.org/Installing+System+Workbench+for+STM32+from+Eclipse">OpenSTM32 web site</a>, however you will need to register for the site and log in to see it.  While it is possible to install components individually, the lab staff finds that the environment works easiest and best if a pre-integrated system is installed.  The following platform-specific instructions will allow you to do that.
  </p>

  <h3>2.1 Installation on the lab computers</h3>
  <p>
    Various applications for the lab computers are already installed.
    Nevertheless, you must invoke a command to configure your account
    to use them.  Open a <b>terminal window</b> by right-clicking anywhere
    on the desktop.  When the terminal window opens type the following:
    <b></b></p><pre><b>        ~ece362/bin/setup
    </b></pre> You should see new icons on your desktop.  One of them
    reruns the "setup" program.  You can use this to update your
    configuration if any new applications are needed.  Another icon is
    created for System Workbench, the main application you will use.
  <p></p>

  <h3>2.2 Installation on your own personal Linux system</h3>
  <p>
    The specific version of Linux supported is Ubuntu LTS, and this is the most reliable platform for SystemWorkbench.  Other distributions may work, but they may involve additional steps not detailed here.  Download the latest version of System Workbench from:<br>
    <a href="http://www.ac6-tools.com/downloads/SW4STM32/install_sw4stm32_linux_64bits-latest.run">http://www.ac6-tools.com/downloads/SW4STM32/install_sw4stm32_linux_64bits-latest.run</a><br>

    Or use the locally-cached version:<br>
    <a href="https://engineering.purdue.edu/ece362/lab/install_sw4stm32_linux_64bits-latest.run">https://engineering.purdue.edu/ece362/lab/install_sw4stm32_linux_64bits-latest.run</a><br>
    Then invoke the installation script with the following command:<br>
    <b></b></p><pre><b>bash install_sw4stm32_linux_64bits-latest.run</b></pre><br>
    You will be prompted for installation locations as well as the system password to install the STlink driver configuration.  <b>Keep track of the location in the file system that SystemWorkbench and Ac6 are installed.  You will refer to them later.</b>  Depending on your particular computer, you may need to issue an additional command for the software to work properly:
    <ul>
      <li>Ubuntu 18.04: <b><code>sudo apt install lib32ncurses5 make</code></b>
      </li><li>Ubuntu 20.04: <b><code>sudo apt install libpython2.7:i386 libncurses5:i386 make</code></b>
    </li></ul>
    The installation script should set up a link on your desktop by which you can invoke System Workbench.  If not, invoke it with [the path to the installation directory]/eclipse.
  <p></p>

  <h3>2.3 Installation on your own personal MacOS system</h3>
  <p>
    MacOS is the least reliable platform for SystemWorkbench, and many students who try to use it are unable to get it to install or cannot use it once it is installed.  Please consult with other students on the Piazza forum to find solutions.  A common solution for the installation problem is to install a virtual machine running Linux or Windows and only use SystemWorkbench in the VM.
    
    Download the latest version of System Workbench from:<br>
    <a href="http://www.ac6-tools.com/downloads/SW4STM32/install_sw4stm32_macos_64bits-latest.run">http://www.ac6-tools.com/downloads/SW4STM32/install_sw4stm32_macos_64bits-latest.run</a><br>
    Or use the locally-cached version:<br>
    <a href="https://engineering.purdue.edu/ece362/lab/install_sw4stm32_macos_64bits-latest.run">https://engineering.purdue.edu/ece362/lab/install_sw4stm32_macos_64bits-latest.run</a><br>
    Then invoke the installation script with the following command (in a terminal shell):<br>
    <b></b></p><pre><b>bash install_sw4stm32_macos_64bits-latest.run</b></pre><br>
    You will be prompted for installation locations as well as the system password to install the STlink driver configuration.  <b>Keep track of the location in the file system that SystemWorkbench and Ac6 are installed.  You will refer to them later.</b>  The installation script should set up a link on your desktop by which you can invoke System Workbench.  If not, invoke it with [the path to the installation directory]/eclipse.
  <p></p>

  <h3>2.4 Installation on your own personal Windows system</h3>
  <p>
    Windows is a reliable platform on which to use SystemWorkbench, but you you should avoid using project names with spaces in them.  (e.g., do not create a project with the name "Project 1".)

    Download the latest version of System Workbench from:<br>
    <a href="http://www.ac6-tools.com/downloads/SW4STM32/install_sw4stm32_win_64bits-latest.exe">http://www.ac6-tools.com/downloads/SW4STM32/install_sw4stm32_win_64bits-latest.exe</a><br>
    Or the locally-cached version:<br>
    <a href="https://engineering.purdue.edu/ece362/lab/install_sw4stm32_win_64bits-latest.exe">https://engineering.purdue.edu/ece362/lab/install_sw4stm32_win_64bits-latest.exe</a><br>
    Then invoke the installer.  You will be prompted for installation locations as well as the system password to install the STlink driver configuration.  <b>Keep track of the location in the file system that SystemWorkbench and Ac6 are installed.  You will refer to them later.</b>
  </p>
  <h4>2.4.1 STLink Driver Installation on Windows</h4>
  <p>
    In the past, the installation for Windows has required an
    additional ST-Link driver to interact with the USB programmer
    module.  This may or may not still be true.  (You can help us
    decide this.)  If you need it, acquire the driver
    from <a href="https://www.st.com/en/development-tools/stsw-link009.html">
    STMicroelectronics</a>, extract the resulting zip file, and
    install the driver.
  </p>

  <h2 id="Download">3 Download the Standard Peripheral Library</h2>
  <p>
    We will use the OpenSTM32 Standard Peripheral Library for most projects in the class.  You may not be able to download it from the host site in the next step.  If not, download a locally-cached version:
    <a href="https://engineering.purdue.edu/ece362/lab/stm32f0_stdperiph_lib_v150.zip">https://engineering.purdue.edu/ece362/lab/stm32f0_stdperiph_lib_v150.zip</a><br>
    You must save the downloaded ZIP file into a particular subdirectory of the "Ac6" installed.  The subdirectory is "<b><em>[The Ac6 installation location]</em><code>/SW4STM32/firmwares/</code></b>".
    </p><ul>
      <li>On the lab computers, your personal Linux system, or your
        personal MacOS system, the subdirectory will be
        <br><b>.ac6/SW4STM32/firmwares</b>.
      </li>
      <li>
        On your personal Windows system, the subdirectory will be
        <br><b>C:\Users\&lt;username&gt;\AppData\Roaming\Ac6\SW4STM32\firmwares</b>
      </li>
    </ul>
    To view the directory on the lab machines, open the "Home" icon file
    browser and use the "View" menu to "Show hidden files".  This will
    cause the <b>.ac6</b> directory to be visible.
  <p></p>
  <p>
    The zip file must be saved with the file name
    "stm32f0_stdperiph_lib_v150.zip".  Unzip the file in that
    subdirectory to create a new subdirectory named
    "STM32F0xx_StdPeriph_Lib_V1.5.0".  <b>SystemWorkbench will look for
    both the ZIP file as well as the unzipped version.  Both must have
    exact names.</b>
  </p>

  <h2 id="Configure">4 Configure SystemWorkbench</h2>
  <p>
    Now that all software tools needed for the STM32F0 have been installed, the Eclipse environment should be configured for student use.  The workspace preferences configuration instructions are heavily based on a set of instructions from the <a href="http://gnuarmeclipse.github.io/eclipse/workspace/preferences/">GNU ARM Eclipse community</a>.  To access the Eclipse Preferences menu, select <b>Window &gt;&gt; Preferences</b> from the Eclipse main menu.
  </p>
  <h3>4.1 General Workspace Preferences</h3>
  <p>
    The first destination is Workspace Preferences, located at <b>General &gt;&gt; Workspace</b> in the Preferences menu.  Uncheck the box which says “Build automatically” (in these experiments, the build process will be initiated via a command).  Additionally, check the box titled “Save automatically before build”.  <b>This is probably the most important setting you can change.  Without it, you will be confused why the program you just modified does not act as you expect.</b>
  </p>
  <p>
    Text encoding and newline delimiters can vary from operating system to operating system, and should be standardized for the purposes of this course.  At the bottom of the Workspace preferences pane, there are two fields with radio buttons: “Text file encoding” and “New text file line delimiter”.  Ensure that the Text file encoding field is specified as UTF-8, while the New text file line delimiter is specified to use Unix-style endings.  (You should not use the "Default (Windows)" even if you are using Windows.  Once all of these changes have been made, click Apply.  All of these settings are summarized in Figure 4.
  </p>
  <figure>
    <img class="lab_img" src="./ECE 362 Lab Experiment 0_files/workspace-prefs.png">
    <b><figcaption>Figure 4: General Workspace Preferences Configuration</figcaption></b>
  </figure>

  <h3>4.2 General Text Editor Preferences</h3>
  <p>
    Occasionally, source code will have to be printed.  When this is done, it is helpful to know where the edge of a page would be, that lines of code can be written of appropriate lengths.  Under the preferences hierarchy, navigate to <b>General &gt;&gt; Editors &gt;&gt; Text Editors</b>.  In the Text Editors preferences pane, click the box labeled "Show print margin" and ensure that the "Print margin column" field is set to 80.  Once these preferences have been made, click Apply.
  </p>

  <figure>
    <img class="lab_img" src="./ECE 362 Lab Experiment 0_files/text-editor-prefs.png">
    <b><figcaption>Figure 5: General Text Editor Preferences Configuration</figcaption></b>
  </figure>

  <h3>4.3 C/C++ Indexer Preferences</h3>
  <p>
    Certain IDEs, including Eclipse, feature a software tool called an Indexer.  An indexer parses source code on the fly, providing hints, auto-completion suggestions, and error reporting to the developer during the process of editing, without having to initiate the build process.  In order for the indexer to provide accurate and relevant hints, the indexer must be in sync with the compiler.
  </p>

  <p>
    In the Preferences menu, navigate to <b>C/C++ &gt;&gt; Indexer</b>.  In the field titled "Build Configuration for the Indexer", select the field titled "Use active build configuration".  Click Apply.
  </p>

  <figure>
    <img class="lab_img" src="./ECE 362 Lab Experiment 0_files/indexer-prefs.png">
    <b><figcaption>Figure 6: C/C++ Indexer Preferences Configuration</figcaption></b>
  </figure>

  <h3>4.4 C/C++ Code Formatting Settings</h3>
  <p>
    Eclipse features a powerful integrated code formatter, which is capable of automatically formatting source code files to conform to a particular coding style of choice.  Eclipse will automatically adhere to the settings of the code formatter when working on new source files.  Alternatively, a file open in Eclipse can be automatically formatted using <b>Source &gt;&gt; Format</b> from the Eclipse main menu.
  </p>
  <p>
    To modify the formatter settings, navigate to <b>C/C++ &gt;&gt; Code Style &gt;&gt; Formatter</b>.  In the resulting pane, a drop down box will appear showing different code formatting styles, as well as a preview of what source code might look like in the resulting style.  Select your style of choice, then click the Edit… button.  A new window will appear, showcasing code formatter style configuration settings.
  </p>
  <p>
    The built-in code formatter styles cannot be modified, so press New and a dialog window will open with a field labeled “Profile Name”.  Provide a name for the new code formatting style (for the purposes of this exercise, the profile name “ECE362” was used).  Choose "K&amp;R C" as a template.  To ensure uniformity of code across development environments, set the field labeled Tab Policy to “Spaces Only”, then click OK.  You will be returned to the Eclipse Preferences menu.  Click Apply.
  </p>

  <figure>
    <img class="lab_img" src="./ECE 362 Lab Experiment 0_files/formatter-prefs.png">
    <b><figcaption>Figure 7: C/C++ Formatter Style Preferences Configuration</figcaption></b>
  </figure>

  <h3>4.5 Build Console Settings</h3>

  <p>
    The build console is a portion of the Eclipse UI which is displayed during the build process.  Build console settings can be found under <b>C/C++ &gt;&gt; Build &gt;&gt; Console</b> in the Eclipse Preferences menu.
  </p>
  <p>
    To ease the build process, check the boxes in the Build Console Preferences pane stating "Bring console to top when building (if present)" and "Wrap lines on the console".  Additionally, increase the field "Limit console output (number of lines):" to a higher value, such as 5000.  Click Apply.
  </p>


  <figure>
    <img class="lab_img" src="./ECE 362 Lab Experiment 0_files/build-console-prefs.png">
    <b><figcaption>Figure 8: Build Console Preferences Configuration</figcaption></b>
  </figure>




  <h2 id="Create">5 Create a project in SystemWorkbench</h2>
  <p>
    Now that the software toolchain is configured, it's time to create a simple project for the STM32F0.  Connect the STM32F091 development board to the USB programmer, and start SystemWorkbench.  A Welcome Screen will appear, which can be closed.  Creation of a project is a six-step incremental process of making selections in dialogs to configure the computer language used for a project, the type of microcontroller (target) to be used, and the support software to be used (firmware).
  </p>

  <h3>5.1 New project</h3>
  <p>
    In the top level Eclipse menu, select <b>File &gt;&gt; New &gt;&gt; C Project</b>.
  </p>

  <figure>
    <img class="lab_img" src="./ECE 362 Lab Experiment 0_files/create-project.png">
    <b><figcaption>Figure 9: Create Project Menu</figcaption></b>
  </figure>

  <h3>5.2 Select a wizard</h3>
  <p>
    Next, you will arrive at the "Select a wizard" dialog.  For the first half of the semester, we will be writing files in assembly language, but we show you how to adapt a C environment to that.  Select "C Project" and press <b>Next</b>.
  </p>

  <figure>
    <img class="lab_img" src="./ECE 362 Lab Experiment 0_files/select-wizard.png">
    <b><figcaption>Figure 10: Select a wizard dialog</figcaption></b>
  </figure>

  <h3>5.3 C Project dialog</h3>
  <p>
    The next dialog is the "C Project" dialog.  Specify "Ac6 STM32 MCU Project", specify a Project name ("project1" was used, but you can pick something meaningful such as "lab0") and click <b>Next&gt;</b>.
  </p>


  <figure>
    <img class="lab_img" src="./ECE 362 Lab Experiment 0_files/c-project.png">
    <b><figcaption>Figure 11: C Project dialog</figcaption></b>
  </figure>

  <h3>5.4 Select Configuration</h3>
  <p>
    The next dialog is the "Select Configurations" dialog which allows you to select the build configurations to be used for the project.  By default, it shows "Debug" and "Release".  We will never use anything other than these, and we will only rarely use "Release".  Just press <b>Next</b> to move on.
  </p>

  <figure>
    <img class="lab_img" src="./ECE 362 Lab Experiment 0_files/select-configurations.png">
    <b><figcaption>Figure 12: Select Configurations dialog</figcaption></b>
  </figure>

  <h3>5.5 Target Configuration</h3>
  <p>
    The next dialog is the "Target Configuration" dialog.  It selects the type of microcontroller to use.  The microcontroller we will use for the class is the STM32F091RCT6.  You should mentally split that up into four parts:  STM32F0 91 RC T6.  To find that with the dialog, <b>first choose the "Mcu" tab at the top of the dialog</b>.  The "Series" is STM32F0 (the default), and the "Mcu" will be found near the bottom of the drop-down list.  There is no specific entry for "STM32F091RCT6".  Instead, you should use the slightly more generic "STM32F091RCTx".  You might temporarily select other microcontrollers on the list and see how it affects the parameters in the box in the center.  Make sure you set it back to "STM32F091RCT6" and then press <b>Next</b>.
  </p>
  
  <p>
    This is a tedious step, and we'll try to find a way to make this just a little easier to select.
  </p>

  <figure>
    <img class="lab_img" src="./ECE 362 Lab Experiment 0_files/target-configuration.png">
    <b><figcaption>Figure 13: Target Configuration dialog</figcaption></b>
  </figure> 

  <h3>5.6 Project Firmware configuration</h3>
  <p>
    Next, the "Project Firmware configuration" dialog appears to ask you what type of firmware you should use for the project you are creating.  For all projects in this course, we will use either "No Firmware" or the "Standard Peripheral Library (StdPeriph)" firmware.  For this experiment, choose "Standard Peripheral Library (StdPeriph)".  Since this is the first time you have used this firmware type, the dialog will appear as it does on the left of the figure below.  It will warn you that the firmware is not installed and prompt you to download it.  Press the "Download target firmware" button, accept the license agreement, and wait a few seconds for it to complete.  If System Workbench fails to download the StdPeriph firmware, download the locally-cached version as detailed in Step 4.
  </p><p>
  </p>
  You only need to download the firmware the first time you use it.  Once the firmware is downloaded, the dialog will always appear as it does on the right.  Then press <b>Finish</b>.
  <p></p>

  <p>
    Eventually, all of these steps necessary to create a project will become automatic for you.  You won't even think about it.
  </p>

  <figure>
    <img class="lab_img" src="./ECE 362 Lab Experiment 0_files/project-firmware-configuration.png">
    <b><figcaption>Figure 14: Project Firmware configuration dialog</figcaption></b>
  </figure>


  <h2 id="Edit">6 Edit build, and debug a project</h2>

  <p>
    Finally we arrive at the main project workspace where we can start manipulating files related to the software project we wish to build.  Eventually, you will become accustomed to going through the steps of creating a new project and it will become an automatic action for you.  (You will usually create one new project for every prelab, lab, and homework that you write.)
  </p>

  <p>
    If you click open the "lab0" element in the Project Explorer on the left, you will see the followinga number of top-level folders.  Not all of these folders will exist at this point.  Some of them will be created after you edit and compile your code.
  </p>
  <ul>
    <li> <u>Binaries</u>: Folder containing your compiled program.
    </li><li> <u>Includes</u>: Global folder containing all of the system-provided C header files used in the project.
    </li><li> <u>inc</u>: Folder containing project-specific C header files you create for the project.
    </li><li> <u>src</u>: Folder containing C source files (including main) you create for the project.
    </li><li> <u>startup</u>: Folder containing device-specific startup files.  Startup files are generally provided as assembly files (for the purposes of ECE362, STM32F0-series assembly files are provided).
    </li><li> <u>Debug</u>: Folder containing the "debug version" of your compiled program.
    </li><li> <u>LinkerScript.ld</u> is the configuration file that tells the linker where to put the segments (e.g.  text and data) of the executable for your compiled program.
  </li></ul>

  <figure>
    <img class="lab_img" src="./ECE 362 Lab Experiment 0_files/project-workspace.png">
    <b><figcaption>Figure 15: Project Workspace default view at startup</figcaption></b>
  </figure>

  <h3>6.1 Editing a source file</h3>
  <p>
    Double-click on the <b>src</b> folder to open it, then double-click on the <b>main.c</b> file to edit it.  The editor window should look similar to the following figure:
  </p>

  <figure>
    <img class="lab_img" src="./ECE 362 Lab Experiment 0_files/editor-window.png">
    <b><figcaption>Figure 16: Editor window</figcaption></b>
  </figure>

  <p>
    System Workbench automatically created this "main.c" file for you.  It includes a comment at the top of the window that looks like "* @file  main.c" that is folded.  If you click on the plus icon near the line number, it will unfold the comment, allowing you to view it.
  </p>
  <p>
    If you press the hammer icon you will see many messages go by explaining that it is building firmware files and compiling the main.c file to produce an executable.  You can run and debug the execution of this simple program on you development board.  Before you do so, you must configure the debugger as well as the programming interface.
  </p>

  <h3>6.2 Debugger Configuration</h3>
  <p>
    Select the Run &gt;&gt; Debug configurations… menu item.  A dialog will appear.  <b><em>Double-click</em></b> on the "Ac6 STM32 Debugging" item on the left side of the screen to create a New_configuration entry.  Notice that the selection for "C/C++ Application" is empty in your dialog window.  Press the "Search Project..." button and select the "lab0.elf" entry that appears.  (This is the executable that you just built in the previous step.)  The result should look similar to the following picture:
  </p>

  <figure>
    <img class="lab_img" src="./ECE 362 Lab Experiment 0_files/debugger-executable.png">
    <b><figcaption>Figure 17: Debugger executable selection </figcaption></b>
  </figure>

  <p>
    Next, you must configure the programmer interface.  While still in the <b>Run &gt;&gt; Debug configurations...</b>, select the "Debugger" tab.  Change the button that normally says "Show generator options..." to "Hide generator options..." and, in the information shown below it, change the option that says "Connect under reset" to "Software system reset".  Then press <b>Apply</b> and <b>Close</b>.
  </p>

  <figure>
    <img class="lab_img" src="./ECE 362 Lab Experiment 0_files/debugger-config.png">
    <b><figcaption>Figure 18: Debugger interface configuration </figcaption></b>
  </figure>

  <p>
    Why do we need to do this?  We're using an inexpensive "clone" ST-LINK programmer that does not have as many features of more sophisticated (and expensive) programmers.  This USB programmer does not use the "reset" signal.  Instead, it asserts a signal on the SWDIO and SWCLK lines to reset the system it is programming and debugging.  We need to change this configuration each time we create a new project.  Thereafter, it is remembered for the project, and the settings will be reinstated when the project is reopened.
  </p>

  <div class="attention">
    <img src="./ECE 362 Lab Experiment 0_files/warning-sign-small.png" style="width: 6em; margin-right: 1em">
    <p>
      Note: When you try to program the microcontroller without
      switching to "Software system reset" SystemWorkbench will
      respond with one of many error dialogs.  When you start
      the debugger, it may tell you something like "Error erasing
      flash with vFlashErase packet".  When you press the "Run"
      button, it may show a message on the console at the bottom
      that says "** Unable to reset target **", wait a minute, and
      then display a dialog window that says that the microcontroller
      is not responding.  Learn to recognize any of these problems,
      change the debugger configuration, and continue.
    </p>
  </div>

  <h3>6.3 Debugging a program</h3>
  <p>
    At this point, you will be able to use the programmer and debugger.  Before doing so, change the <b><code>main()</code></b> function to look like this:
  </p>
  <b><pre>      #include "stm32f0xx.h"
      
      int main(void) {
          int x = 0;
          int y = 0;
          for(;;) {
              x += 1;
              y -= 1;
          }
      }
  </pre></b>

  <p>
    When you press the debug icon (the blue bug) below the menu bar, your project code should be rebuilt, the debugger will be invoked, and System Workbench will prompt you to change to a different <em>perspective</em>.  Click <b>Yes</b> on the perspective change dialog and accept it as default action.  The new perspective for the debugger should look like the following image:
  </p>

  <figure>
    <img class="lab_img" src="./ECE 362 Lab Experiment 0_files/debugger-perspective.png">
    <b><figcaption>Figure 19: Debugger perspective </figcaption></b>
  </figure>

  <p>
    If you do not see the debugger perspective, it could be because the programmer was not wired properly.  Check your wiring and compare it carefully to the user manual.
  </p>

  <p>
    The editor is now reduced to a smaller portion of the screen (highlighted in red).  There is now a series of buttons below the menu bar to control the debugger operation (highlighted in green).  An information window (highlighted in orange) shows variable values, breakpoints, register contents, and I/O registers.  Finally, a perspective selection buttons (highlighted in blue) can be used to switch back to the main editor perspective.
  </p>

  <h3>6.4 Using the Debugger</h3>
  <p>
    Hover over the debugger control buttons under the menu bar (highlighted in green in Figure 19) to learn their functions before doing the following steps.  The controls are as follows:
  </p>

  <figure>
    <img class="lab_img" src="./ECE 362 Lab Experiment 0_files/debugger-controls.png">
    <b><figcaption>Figure 20: Debugger controls </figcaption></b>
  </figure>

  <nl>
    <li>Press either the "Step Into (F5)" or "Step Over (F6)" buttons several times.  (We have no subroutines in this program, so either one does the same thing here.)  Notice how the highlighting in the editor window changes to show the statement that is ready to execute next.
    </li><li>In the information window in the upper right quadrant of the screen, select the "Variables" tab.  Press the "Step Into" or "Step Over" buttons again to continue executing the C program.  Notice how the value of the "x" and "y" variables change.
    </li><li>Press the debugger control button that will "Reset the chip and restart debug session".  Notice how it does exactly what it says it does.
    </li><li>Press the "Terminate (Ctrl+F2)" button  and notice that all the debugger control buttons turn gray and become inoperative.  To restart the debugger, press the debugger button again (small blue bug under the menu bar).
    </li><li>Once the debugger is restarted, press the button that will "Resume (F8)".  Notice how many of the debugger control buttons turn gray and become inoperative.  At this point, your program is running unhindered on the development board.
    </li><li>Press the button that will "Suspend" the debugger.  Notice how the variable display shows large values now.  This happened because the microcontroller was allowed to run very quickly and update the variable as fast as it could.
  

  <div class="attention">
    <img src="./ECE 362 Lab Experiment 0_files/warning-sign-small.png" style="width: 6em; margin-right: 1em">
    <p>
      Note: If you try to start a debug session when the debugger
      is already running, it will fail with a message that says
      something like "Error launching debugger".  Look for the red
      square that indicates the debugger is already running.
      Use that button to "Terminate the debugger" before trying
      to restart it.
    </p>
  </div>

  <h3>6.5 Excluding a source file and adding a new one</h3>
  <p>
    Press the "Terminate debugger (Ctrl+F2)" button, and go back to the "C/C++" Workspace Perspective by clicking on the icon in the upper right corner with a "C" on it.  It is next to the "Debug" button (another blue bug icon) in the upper right corner.  The view should be restored to it was in Figure 15.  On the right is the list of folders, and the <b>src</b> folder contains <b>main.c</b>.  Right click (or command-click) on the <b>main.c</b> to bring up a context menu.  Select "Resource Configurations" and "Exclude from Build..."
  </p>

  <figure>
    <img class="lab_img" src="./ECE 362 Lab Experiment 0_files/exclude-from-build.png">
    <b><figcaption>Figure 21: Exclude from build </figcaption></b>
  </figure>

  <p>
    A dialog will appear.  Press "Select all" and "OK".  Now main.c is <em>grayed out</em>.  It is no longer compiled into your program.  If you attemted to compile and run the program, an error would appear in the message console that says "undefined reference to 'main'".  (Try it.)
  </p>

  <p>
    Add a new source file by right clicking on the <b>src</b> folder and selecting <b>New &gt;&gt; Source File</b>.  When the dialog appears, type the name for "Source file:" as "lab0.s" and choose "&lt;None&gt;" as the template as shown in the figure below.  This will be understood by SystemWorkbench to be an assembly language file.
  </p>

  <figure>
    <img class="lab_img" src="./ECE 362 Lab Experiment 0_files/new-source-file.png">
    <b><figcaption>Figure 22: New source file</figcaption></b>
  </figure>

  <p>
    When the (completely empty) lab0.s appears in the editor window, enter the following text into it:
  </p>
  <b><pre>
      .cpu cortex-m0
      .thumb
      .syntax unified
      .fpu softvfp

      .global main
      main:
      movs r0, #0
      movs r1, #0
      loop:
      adds r0, #1
      subs r1, #1
      b    loop

  </pre></b>

  <p>
    Invoke the debugger to see how the system works with assembly language instead of C.  Now the "Step Into (F5)" or "Step Over (F6)" advance one line at a time.  Each line that does not start with a dot is a single machine instruction.  Although you have not learned how assembly language works yet, you may recognize that "adds r0, #1" will add one to the R0 register.  Click on the "Registers" tab in the information window (the orange highlighted region in Figure 19).  As you step through one instruction at a time, notice how the values for general registers R0 and R1 change. 
  </p>

  <h3 id="Cdebug">6.6 Demonstrate C debugging to a teaching assistant</h3>
  <p>
    Once you get your program running, ask a TA to check your work.
    He or she will ask you to exclude the assembly language file and
    reselect the main.c file.  You will then demonstrate that you know
    how to set breakpoints and step through execution of a C program.
  </p>

  <h3 id="ASMdebug">6.7 Demonstrate assembly debugging to a teaching assistant</h3>
  <p>
    You will then select the main.s file and exclude the main.c file
    to run the assembly language section.  Step through the execution
    of each instruction and see how the registers are updated by each
    instruction.
  </p>

  <h3>6.8 Adding a precompiled module to your program</h3>
  <p>
    Many times throughout the course for lab experiments and homework assignments, you will be provided with a <em>compiled module</em> that can be used to automatically test the code that you write.  Sometimes, it will provide some kind of functionality that we expect you to learn how to do yourself.  We don't want to just give you the source code for it.
  </p>
  <p>
    Download the <em>object file</em> <a href="https://engineering.purdue.edu/ece362/lab/lab0/autotest.o">autotest.o</a> and save it into the <b>src</b> folder of your <b>lab0</b> project.  To do this, you will need to learn where the subdirectories exist in your Eclipse/SystemWorkbench workspace.  Depending on the computer platform you use, you may be able to copy and paste it.
  </p>
  <p>
    Next, follow <a href="https://engineering.purdue.edu/ece362/refs/eclipse/pre-compiled-module.html">the instructions</a> for integrating the compiled module into your project.  For lab 0, the compiled module will act as a <em>device driver</em> that will make the serial port work, collect information about your work, and provide an indication that you completed it.
  </p>

  <p>
    Change your "lab0.s" module to the following contents:
  </p>

  <b><pre>      .cpu cortex-m0
      .thumb
      .syntax unified
      .fpu softvfp

      .global main
      main:
      movs r0,#4
      movs r1,#6
      movs r2,#5
      movs r3,#9
      adds r0,r3,r2
      subs r1,r3,r1
      bl autotest
      bkpt

      .global login
      login:
      .asciz "xyz"
      .align 2
  </pre></b>


  <p>
    Change the letters <b>xyz</b> to your ECN login (the username you
    use to access the ECE 362 web page).  The <b>bl</b> instruction
    invokes a subroutine call to a function in the compiled module
    named <b><code>autotest()</code></b>.  This function never
    returns, and you will not be able to examine its source code.  The
    function looks at the <b><code>login</code></b> symbol to find out
    what your login is, and it will print it on the serial port, along
    with other information.
  </p>

  <p>
    You may try to use the debugger to step through the program to see
    what each instruction does.  Once it reaches the <b>bl autotest</b>
    instruction, it will no longer show the source code.  This is because
    the autotest.o module is not compiled to provide debug information.
    You can still see the instructions that it executes.
  </p>

  <h2 id="Wire">7 Wire a serial-to-USB adapter</h2>

  <p>
    <b>You will use this serial port wiring on all subsequent labs.</b>
    Ensure that your breadboard is clear of other wiring.  You will
    incrementally add things as the semester goes on.
  </p>

  <p>
    Consult the documentation on
    the <a href="https://engineering.purdue.edu/ece362/refs/ftdi-serial">FTDI USB-to-serial
    adapter</a> page.  <font color="red">Be sure to set the adapter
    for 3V operation.</font>  Then wire the serial port as follows:
  </p>
  <ul>
    <li>Connect the Rx pin (2nd pin) of the FTDI adapter to pin
      PC12 of the STM32 board.</li>
    <li>Connect the Tx pin (3rd pin) of the FTDI adapter to pin
      PD2 of the STM32 board.</li>
    <li>Connect the GND pin (6th pin) of the FTDI adapter to ground
      of the breadboard.</li>
    <li>Connect the CTS pin (5th pin) of the FTDI adapter also to
      ground.</li>
  </ul>

  <figure>
    <a href="./ECE 362 Lab Experiment 0_files/ftdi-wiring.jpg">
      <img class="lab_img" src="./ECE 362 Lab Experiment 0_files/ftdi-wiring.jpg" style="width:30em">
    </a>
    <b><figcaption>Figure 23: FTDI USB-to-serial adapter wiring</figcaption></b>
  </figure>

  <figure>
    <a href="./ECE 362 Lab Experiment 0_files/ftdi-inserted.jpg">
      <img class="lab_img" src="./ECE 362 Lab Experiment 0_files/ftdi-inserted.jpg" style="width:30em">
    </a>
    <b><figcaption>Figure 24: FTDI USB-to-serial adapter inserted</figcaption></b>
  </figure>

  <h3 id="Interact">7.1 Interact with a serial port</h3>
  <p>
    <font color="red">Let your TA check your wiring before you plug in
    the USB cable to ensure that you will not damage anything.</font>
    He or she will check that the adapter is set for 3.3 V operation
    and that the Rx and Tx pins are connected to the proper
    microcontroller pins.  Connect a USB cable between the adapter and
    your computer so that you can interact with the serial port
    system.
  </p>

  <p>
    On the lab computer, there is an icon labeled "Serial Port".  When
    you click on it, a terminal window opens and attaches to the
    USB-to-serial adapter port.  The terminal window will show the
    serial port output.  Typing on the keyboard sends input to the
    serial port.
  </p>

  <p>
    If you are using your own computer, follow
    the <a href="https://engineering.purdue.edu/ece362/refs/ftdi-serial">USB-to-serial adapter page
    instructions</a> for setting up a terminal program and watching
    the output.  Set the terminal for a <em>baud rate</em> of 115200
    and an 8-bit word with no parity.
  </p>

  <p>
    Invoke the assembly language program on the microcontroller to
    call the autotest subroutine.  It will produce output on the
    serial port.
  </p>

  <h2 id="Postlab">8 Submit your postlab results</h2>

  <p>
    Once your program compiles, and you can program and run the code
    on the STM32, and you see your ECN login displayed on the serial
    port, it will prompt you to press a single key in the terminal.
    Once you do, the compiled module will display a code on the
    serial port output.  It will look something like Figure 25, although the
    code shown is invalid, so don't try that one.  This code is a
    cryptographic confirmation that you have completed the lab
    experiment.  It is normal for the code to change every time you
    run it.  Choose one of the codes and carefully enter all 32
    characters into
    the <a href="https://engineering.purdue.edu/ece362/submit/?item=postlab0">postlab
    submission</a> for this lab experiment.
  </p>
  <p>
    Note that this code will uniquely identify your microcontroller.
    This is the microcontroller that you will be expected to use for
    the rest of the class (unless you fry yours and need to get a new
    one).  If you're sharing a microcontroller with another student,
    you will both receive a zero for this assignment.  Get your own.
    Use your own.
  </p>


  <figure>
    <img class="lab_img" src="./ECE 362 Lab Experiment 0_files/completion-code.jpg">
    <b><figcaption>Figure 25: Example of completion code (Note: It's invalid.  You'll need your own.)</figcaption></b>
  </figure>

  <p>
    For most labs, there is a requirement that you submit the program
    that you wrote so that it can be checked by the course staff.  You
    don't really know how to write any programs yet, and we gave you
    everything you need.  The real work for this lab experiment was
    reading, learning, stepping through the instructions, and running
    the result on your own microcontroller.
  </p>

  <h2 id="Checklist">Lab Evaluation Checklist</h2>
  <p>
    Here are the things you need to get checked for this lab:
    </p><ul class="chklst">
      <li><div class="chkbox"><input class="inputbox" type="checkbox"><span class="spanbox"></span></div>
        6.6 Demonstrate that you can debug a C program on your microcontroller
      </li>
      <li><div class="chkbox"><input class="inputbox" type="checkbox"><span class="spanbox"></span></div>
        6.7 Demonstrate that you can debug an assembly program on your microcontroller
      </li>
      <li><div class="chkbox"><input class="inputbox" type="checkbox"><span class="spanbox"></span></div>
        Did you clean up your lab station?
      </li>
      <li><div class="chkbox"><input class="inputbox" type="checkbox"><span class="spanbox"></span></div> Did you
        bring any food or liquid into the lab and fail to place it
        beside the sink in the back of the room?
      </li>
      <li><div class="chkbox"><input class="inputbox" type="checkbox"><span class="spanbox"></span></div>
        You did not share your microcontroller with anyone else, right?
        We will know if you did.
      </li>
    </ul>
  <p></p>

  	<footer>
		<p>Questions or comments about the course and/or the content of these
		webpages should be sent to the <a href="mailto:ece362@ecn.purdue.edu">
		Course Webmaster</a>.  All the materials on this site are intended
		solely for the use of students enrolled in ECE 362 at the Purdue
		University West Lafayette Campus.  Downloading, copying, or
		reproducing any of the copyrighted materials posted on this site
		(documents or videos) for anything other than educational purposes
		is forbidden.</p>
	</footer>



</li></nl></body></html>